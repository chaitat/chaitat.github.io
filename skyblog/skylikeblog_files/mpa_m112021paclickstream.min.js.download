$device='mobile';$tc=$('meta[name="pt:data"]').attr("content");var start=Date.now();var tmp;var OSName="Unknown OS";var isActive,okay=true;var $referrer=document.referrer;var $urlAjaxGeo='/datacst/streamclickrepo/';var $location_type=1;$topic_id='';$comment_id='0';$scrollTop=0;var comment='';var profile=0;var chk_popup=false;var chk_click=true;detail_data={};$(document).ready(function(){});$(document).on('click','.m-sticky-sharing img',function(e){$share_butt=$(this).attr("alt");if($share_butt=='facebook button'){$event='share:facebook';}else if($share_butt=='twitter button'){$event='share:twitter';}else if($share_butt=='line button'){$event='share:line';}else{$event='share:copy-link';}
ajax_process($event);});$(document).on('click','.spoil-btn , .youtube-thumbnail',function(e){$event='';if($(this).hasClass('spoil-btn')){$event='spoil';}
if($(this).hasClass('youtube-thumbnail')){$youtube_url=$(this).children('a.video_id').attr("href");$event='youtube';}
if($event!=''){var datapost=$(this).parents('.cs-elm').data('idpostcs');var data=getDataCSDetailTopic(datapost);comment=data.comment;$topic_id=data.topic_id;ajax_process($event);}});$(document).on('click','.cs-elm-profile',function(e){$event='profile';var datapost=$(this).data('idpostcs');var data=getDataCSDetailTopic(datapost);var urlProfile=$(this).find('a:first').attr('href');if(urlProfile!=undefined){profile=urlProfile.replace(/^https?:\/\/(?:m\.)?pantip\.com\/profile\/([0-9]+).*$/,"$1");}
comment=data.comment;$topic_id=data.topic_id;ajax_process($event);});$(document).on('click','a',function(e){if(chk_click===true){$topic_id=($(".topic-title").attr("id"));if($topic_id!==undefined){$topic_id=$topic_id.replace(/^topic-([0-9]+).*$/,"$1");}
var comment_elm=$(this).parents(".pt-m-wrap-comment");var is_comment_box=(comment_elm.length===1?true:false);if(is_comment_box){$comment_id=comment_elm.find(".m-display-post-number").html();$comment_id=$comment_id.replace(/^.*(?:comment|ความคิดเห็นที่ +|P|E)([0-9\-]+).*$/,"$1");comment=$comment_id;}
else{if($(this).parents(".m-post-owner").length===1){$comment_id='0';comment=$comment_id;}}
$event='click';var detail_xy={};var detail_click={}
detail_click=getDetailElementData(this);detail_xy=getWidthHeightElement(e);detail_data=Object.assign(detail_click,detail_xy);ajax_process($event);}});function getDataCSDetailTopic(datapost)
{var arrType=datapost.split(':');var type=arrType[0];var arrTypePost=arrType[1].split('-');var topic_id=arrTypePost[0];var comment_id=0;var comment_no=0;var reply_no=0;var comment_reply='';var dataDetailTopic={};if(datapost!=""&&arrType!=undefined){dataDetailTopic={'topic_id':topic_id};if(type=='comment'||type=='reply'){comment_id=arrTypePost[1];comment_no=arrTypePost[2];comment_reply=""+comment_no;dataDetailTopic={'topic_id':topic_id,'cid':comment_id,'comment':comment_reply,'comment_no':comment_no};if(type=='reply'){reply_no=arrTypePost[3];reply_id=arrTypePost[4];comment_reply=""+comment_no+"-"+reply_no;dataDetailTopic={'topic_id':topic_id,'cid':comment_id,'comment':comment_reply,'comment_no':comment_no,'reply_no':reply_no,'reply_id':reply_id};}}}
return dataDetailTopic;}
function pageShown(evt){if(typeof latitude=="undefined"||typeof longitude=="undefined"||typeof latitude=="null"||typeof longitude=="null"){latitude='Disallow';longitude='Disallow';}
$url=window.location.href;$event="start";ajax_process($event);}
window.addEventListener("pageshow",pageShown,false);$(document).ready(function(){timer=0;setInterval("timer++",1000);$topic_id=($(".topic-title").attr("id"));if(typeof $topic_id==undefined){$topic_id='0';}else{try{$topic_id=$topic_id.match(/[ 0-9 ]+/);}catch(e){$topic_id=window.location.href.match(/[ 0-9 ]+/);}}
navigator.sayswho=(function(){var ua=navigator.userAgent,tem,M=ua.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];if(/trident/i.test(M[1])){tem=/\brv[ :]+(\d+)/g.exec(ua)||[];return'IE '+(tem[1]||'');}
if(M[1]==='Chrome'){tem=ua.match(/\b(OPR|Edge)\/(\d+)/);if(tem!=null)
return tem.slice(1).join(' ').replace('OPR','Opera');}
M=M[2]?[M[1],M[2]]:[navigator.appName,navigator.appVersion,'-?'];if((tem=ua.match(/version\/(\d+)/i))!=null)
M.splice(1,1,tem[1]);return M.join(' ');})();navigator.browser=(function(){var ua=navigator.userAgent,tem,M=ua.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];web_browser=M[1];return web_browser;})();if(navigator.appVersion.indexOf("Win")!=-1)
OSName="Windows";if(navigator.appVersion.indexOf("Mac")!=-1)
OSName="MacOS";if(navigator.appVersion.indexOf("X11")!=-1)
OSName="UNIX";if(navigator.appVersion.indexOf("Linux")!=-1)
OSName="Linux";});$url=window.location.href;$user_agent=(navigator.userAgent).substring(0,200);$browser=navigator.sayswho;$os=OSName;function get_comment_from_url(){return $url.match(/comment[0-9]*[-]*[0-9]*/g);}
function ajax_process($evt){if($evt=='start'||$evt=='click'){if(($referrer).length==0){$referrer='0';}
$comment_id=get_comment_from_url();if($comment_id==null){$comment_id=0;}
$add_on='&referrer='+encodeURIComponent($referrer)+'&user_agent='+$user_agent+'&os='+OSName+'&browser='+navigator.sayswho;}else if($evt=='youtube'){$add_on='&youtube='+$youtube_url+'&os='+OSName+'&browser='+navigator.sayswho;}else{$add_on='&os='+OSName+'&browser='+navigator.sayswho;}
if(typeof x=='undefined'||typeof y=='undefined'||typeof x==undefined||typeof y==undefined||typeof x==null||typeof y==null||typeof x=='undefined'||typeof y=='undefined'||typeof x=='null'||typeof y=='null'){x=0;y=0;$location_type='Ignore';}
if((typeof $comment_id=='object')){$comment_id=String($comment_id);if(!$comment_id.match(/([0-9])+$/i)){$comment_id='0';}}
if((typeof $comment_id=='string')){if(!$comment_id.match(/([0-9])+$/i)){$comment_id='0';}
else{$comment_id=$comment_id.replace(/^.*(?:comment|ความคิดเห็นที่ +|P|E)([0-9\-]+).*$/,"$1");}}
else{$comment_id='0';}
if(comment!=''&&comment!=undefined){$comment_id=comment;}
$data='url='+encodeURIComponent($url)+'&tc='+$tc+'&location='+x+','+y+'&status_location='+$location_type+'&event='+$evt
+'&topic_id='+$topic_id+'&comment_id='+$comment_id+'&device='+$device
+$add_on;if($evt=='profile'){$data=$data+'&profile='+profile;}
var jsonDataPost={};jsonDataPost=$data;if($evt=='click'){var addDataOn={'url':encodeURIComponent($url),'topic_id':$topic_id,'comment_id':$comment_id,'tc':$tc,'location':x+','+y,'status_location':$location_type,'event':$evt,'device':$device,'referrer':encodeURIComponent($referrer),'user_agent':$user_agent,'os':OSName,'browser':navigator.sayswho};jsonDataPost={'data':addDataOn,'detail_data':detail_data};}
$.ajax({url:$urlAjaxGeo,type:'post',data:jsonDataPost,success:function($json){okay=false;},error:function(xhr,ajaxOptions,thrownError){}});}
function getDetailElementData(element){var code_sc=element.dataset.sc;var tag=element.tagName.toLowerCase();var id=element.id;var className=element.className;var text=element.innerText.substring(0,10000);var dataJson={};dataJson={"code":"zaqwsxc","tag":tag,"id":id,"class":className,"text":text};if(tag=='a'){var hrefURL=element.href;dataJson={"code":"zaqwsxc","tag":tag,"id":id,"class":className,"text":text,"href":hrefURL,"sc":code_sc};}
return dataJson;}
function getWidthHeightElement(e){var x=e.pageX+"px";var y=e.pageY+"px";var window_width=window.innerWidth+"px";var window_height=window.innerHeight+"px";var scroll_top=$(document).scrollTop();scroll_top=(Math.round(scroll_top*100)/100)+"px";var dataJson={"scroll_top":scroll_top,"x":x,"y":y,"window_width":window_width,"window_height":window_height};return dataJson;}
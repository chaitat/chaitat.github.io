var x;$(document).ready(function(){$.comment.bbcode();$.comment.bbImage();$.comment.postFormComment();$.comment.editPostComment();$.reply.postComment();$.reply.editPostComment();$.comment.showDeleteCommentReply();$("#pt_modal_menu_action").removeClass("pt-modal-mask");$(".pt-dropdown-menu").removeClass("pt-block-surface--open");$(".display-post-edit-hide").hide();$(document).on('click',".down-button",function(){$('body').addClass('hide-scroll-modal');var iconname=$(this).attr("id").replace('icondown','iconaction');$("#"+iconname).addClass("pt-block-surface--open");$("#pt_modal_menu_action").addClass("pt-modal-mask");});$(document).on('click touchstart',"#pt_modal_menu_action",function(){$('body').removeClass('hide-scroll-modal');$(".pt-dropdown-menu").removeClass("pt-block-surface--open");$("#pt_modal_menu_action").removeClass("pt-modal-mask");$("#bb_lightbox_action_vote").removeClass("pt-toast--open");$('.pt-m-reaction-list').removeClass('active');$('#bb_lightbox_action_emotion').removeClass('pt-block-surface--open');$('#list-share-icon').addClass('list-share__Inactive');});$.comment.actionVote();$.comment.actionEmotion();$.comment.actionReportMessage();$.pinIt.mark();$.pinIt.pinComment();});function markCommentPinItNext()
{var mypinitVal=$('.mypinit-datamark').val();var comment_number=mypinitVal.replace('comment','');$('.pinit_comment'+comment_number).removeClass('comment-unpin');$('.menu_pinit_comment'+comment_number).addClass('read-pinit').html('<span class="pt-lists-item__graphic material-icons">turned_in</span>'
+'<span class="pt-lists-item__text">ยกเลิกอ่านถึงตรงนี้</span>');}
(function($){$.reply={};$.comment={};$.comment.defaults={urlPath:'https://pantip.com/forum/topic/save_comment_mobile',urlLogin:'https://pantip.com/login',};$.comment.bbcode=function()
{$(document).on('click','.bb_btn_cancel',function(){$('#bb_lightbox_image').removeClass('pt-m-modal-mask');clearImageLightBox();return false;});$(document).on('click','.bb_btn_cancel_close',function(){$('#bb_lightbox_message').removeClass('pt-m-modal-mask');$('#pt_modal_menu_action').trigger('click');return false;});$(document).on('click','.bb_btn_confirm_close',function(){closeBoxPostText();return false;});$(document).on('click','#arrowBackPost',function(){var txt_error='';var textData=$.trim($("#mobile-input").val());if(textData.length>0){var txt_error_type='confirm';var option={'title':'ข้อความแจ้งเตือน','text':'หากกด "ตกลง" ข้อความที่พิมพ์ไว้จะหาย และกลับเข้าหน้ากระทู้ค่ะ'};txt_error=txtError(txt_error_type,option);$('.msg-bb_lightbox_message').html(txt_error);$('#bb_lightbox_message').addClass('pt-m-modal-mask');}
else{closeBoxPostText();}});$(document).on('click','#pt-editor-switch, .pt-ic-text_format',function(){if($('#pt-editor-switch').hasClass('active')){defaultBoxText();}
else{$('#pt-editor-switch').addClass('active');$('#pt-upload-tool').addClass('pt-m-editor__Inactive');$('#pt-upload-tool').removeClass('pt-m-editor__Active');$('#pt-text-tool').addClass('pt-m-editor__Active');$('#pt-text-tool').removeClass('pt-m-editor__Inactive');}});$(document).on('click','.bb_btn_mutilinks_close',function(){$('.bb_detail_input').addClass('hidden-obj');$('#bb_lightbox_message_mutilinks').removeClass('pt-m-modal-mask');return false;});$(document).on('click','.bb_btn_mutilinks',function(){var urlTextData=$.trim($('input[name=bb_input_name]').val());var classNameAll=$.trim($('input[name=bb_input_name_action]').val());if(urlTextData.length<1){$("#submit-error-mutilinks").html('กรุณาใส่ URL ที่ต้องการก่อนค่ะ');return false;}
var className=$.trim(classNameAll.replace('pantip-icons icolor-secondary ',''));var videoTag='youtube';if(className=='pt-ic-insert_video'){var isYoutube=urlTextData.match(/(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?|shorts)\/|.*v=)|(?:youtu\.be\/))([-|~_0-9A-Za-z]{11})/i)!=null;var isVimeo=urlTextData.match(/^(\s+)?http(?:s)?:\/\/vimeo\.com\/(\d+)/i)!=null;if(!isYoutube&&!isVimeo){$("#submit-error-mutilinks").html('กรุณาใช้ลิงก์ YouTube หรือ Vimeo เท่านั้น');return false;}
if(isVimeo){videoTag='vimeo';}}
var t_area=$("#mobile-input");var nameClassTag={'pt-ic-insert_video':videoTag,'pt-ic-insert_map':'googlemaps','pt-ic-insert_link':'url'}
if(nameClassTag[className]!=undefined){t_area.surroundSelectedText("["+nameClassTag[className]+"]"+urlTextData,"[/"+nameClassTag[className]+"]",true);t_area.focus();}
$('#bb_lightbox_message_mutilinks').removeClass('pt-m-modal-mask');});$(document).on('click','.pt-ic-insert_map',function(){var classAction=$(this).attr('class');$('.bb_detail_input').addClass('hidden-obj');$('.bb_detail_googlemaps').removeClass('hidden-obj');$('.bb_detail_header').html('ใส่ Google Maps');$("#submit-error-mutilinks").html('');$('input[name=bb_input_name]').val('');$('input[name=bb_input_name_action]').val(classAction);$('#bb_lightbox_message_mutilinks').addClass('pt-m-modal-mask');});$(document).on('click','.pt-ic-insert_video, .pt-ic-insert_link',function(){var txt_error='';var topic={topic_id:$('input[name=topic_id]').val(),topic_type:$('input[name=type]').val()};var classAction=$(this).attr('class');$('.bb_detail_input').addClass('hidden-obj');var type='';var textClassAction='';var detailsClass='';if($(this).hasClass('pt-ic-insert_video')){type='video';textClassAction='Youtube หรือ Vimeo';detailsClass='bb_detail_youtube';}else if($(this).hasClass('pt-ic-insert_link')){type='link';textClassAction='URL';detailsClass='bb_detail_url';}
var ajax_send=false;if(ajax_send==false){ajax_send=true;$.ajax({url:"/topic/getUserPS",type:"POST",dataType:'json',data:topic,cache:false,success:function(rs){if(rs.ps!=undefined&&(type=='link'&&rs.ps.link==true)||(type=='video'&&rs.ps.video==true)){$('.'+detailsClass).removeClass('hidden-obj');$('.bb_detail_header').html('ใส่ '+textClassAction);$("#submit-error-mutilinks").html('');$('input[name=bb_input_name]').val('');$('input[name=bb_input_name_action]').val(classAction);$('#bb_lightbox_message_mutilinks').addClass('pt-m-modal-mask');}else{var option=null;txt_error=txtError('typeOtherPermission',option);$('.msg-bb_lightbox_message').html(txt_error);$('#bb_lightbox_message').addClass('pt-m-modal-mask');}}});}});$(document).on('click','.pt-ic-insert_image',function(){var txt_error='';var topic={topic_id:$('input[name=topic_id]').val(),topic_type:$('input[name=type]').val()};var ajax_send=false;if(ajax_send==false){ajax_send=true;$.ajax({url:"/topic/getUserPS",type:"POST",dataType:'json',data:topic,cache:false,success:function(rs){if(rs.ps!=undefined&&rs.ps.img==true){$('#bb_lightbox_image').addClass('pt-m-modal-mask');}
else{var option=null;txt_error=txtError('typeOtherPermission',option);$('.msg-bb_lightbox_message').html(txt_error);$('#bb_lightbox_message').addClass('pt-m-modal-mask');}}});}});$(document).on('click','.pt-ic-insert_toys',function(e){e.preventDefault();var ajax_send=false;if(ajax_send==false){ajax_send=true;$.ajax({url:"/feeling/getPantipToyList",type:"POST",dataType:'html',cache:false,success:function(rs){$('#bb_lightbox_pantip_toy').html(rs).addClass('pt-m-modal-mask');}});}});$(document).on('click','.bb_btn_pantiptoy_close',function(){$('#bb_lightbox_pantip_toy').removeClass('pt-m-modal-mask');});$(document).on('click','.btn_pantip_toy',function(e){e.preventDefault();var tab_name=$(this).data("tabpantiptoy");$('.pt-m-carousel-label').addClass('pt-m-label-inactive');$(this).removeClass('pt-m-label-inactive');$('.toysContent').hide();$('#'+tab_name).show();});$(document).on('click','.bb_input_pantiptoy',function(){var t_area=$("#mobile-input");var cmdpost=$('input[name=cmpost]').val();var topic_id=$('input[name=topic_id]').val();var comment_no=$('#replynumber').html();var action='POST';if(cmdpost!=undefined){if(cmdpost=='editcomment'||cmdpost=='editreply'){action='EDIT';}}
$event='toy';$toyname=$(this).data("bb_input_pantip_toyname");$topic_id=topic_id;$action_toyname=action;if(comment_no==undefined||comment_no==''){comment_no='0';}
comment=comment_no;ajax_process($event);var pantip_toy_text=$(this).data("bb_input_pantip_toy_name");if(pantip_toy_text!=undefined){t_area.surroundSelectedText(pantip_toy_text,"",true);t_area.focus();}
return false;});$(document).on('click','.pantip-icons.icolor-secondary',function(){var t_area=$("#mobile-input");var classNameAll=$(this).attr('class');var className='';var nameClassTag={'pt-ic-insert_spoil':'spoil','pt-ic-text_bold':'b','pt-ic-text_italic':'i','pt-ic-text_underlined':'u','pt-ic-stikethrough':'s','pt-ic-format_align_left':'left','pt-ic-format_align_center':'center','pt-ic-format_align_right':'right'};className=$.trim(classNameAll.replace('pantip-icons icolor-secondary ',''));if(nameClassTag[className]!=undefined){t_area.surroundSelectedText("["+nameClassTag[className]+"]","[/"+nameClassTag[className]+"]",true);t_area.focus();}
return false;});$(document).on('click','.pt-m-share-button.open-share-btn',function(){var cls=$('#list-share-icon').hasClass('list-share__Inactive');if($('#list-share-icon').hasClass('list-share__Inactive')){$('#list-share-icon').removeClass("list-share__Inactive");}
else{$('#list-share-icon').addClass("list-share__Inactive");}
return false;});$(document).on('click','#btn_ptic_favorite',function(){var idtextpost=$(this).data('idpostcs');var eventVal='bookmark:add';var txt_error='';var bk_action='pop';if($(this).hasClass('favorite__Inactive')){bk_action='push';}
var data={'action':bk_action,'topic_id':$('input[name=topic_id]').val()};var ajax_send=false;if(ajax_send==false){ajax_send=true;$.ajax({url:"/topic/booksmark",type:"POST",dataType:'json',data:data,cache:false,success:function(rs){if(rs.success!==undefined){if(rs.bk_action=='pop'){$('#btn_ptic_favorite').addClass("favorite__Inactive");eventVal='bookmark:del';}
else{$('#btn_ptic_favorite').removeClass("favorite__Inactive");eventVal='bookmark:add';}
toCsElmStream(idtextpost,eventVal);}
else{var option=null;txt_error=txtError(rs.error_type,option);return false;}}});}
return false;});}
$.comment.bbImage=function()
{$(document).on('change','#photo',function(e){$("#submit-error").html('');$('#photo_name').val('');var file=e.target.files[0];if(file.size>700*1000){canvasResize(file,{width:1024,crop:false,quality:90,rotate:0,callback:function(data,w,h){var reader=new FileReader();reader.onload=function(event){var img=new Image();var heightImg=150;var widthImg='auto';img.onload=function(){$('#preview_photo').html('');if(img.width<200){heightImg='auto';widthImg=img.width;}
$(this).css({'margin':'10px auto','height':heightImg,'width':widthImg}).appendTo('#preview_photo');};$(img).attr('src',data);$('#h_canvas_photo').val(data);$('#bb_btn_insert_img').removeClass('hidden-obj');$('#photo_name').val(e.target.value);};reader.readAsDataURL(file);}});}else{var reader=new FileReader();reader.onload=function(event){var img=new Image();var heightImg=150;var widthImg='auto';img.onload=function(){$('#preview_photo').html('');if(img.width<200){heightImg='auto';widthImg=img.width;}
$(this).css({'margin':'10px auto','height':heightImg,'width':widthImg}).appendTo('#preview_photo');};$('#h_canvas_photo').val(event.target.result);$(img).attr('src',event.target.result);$('#bb_btn_insert_img').removeClass('hidden-obj');$('#photo_name').val(e.target.value);};reader.readAsDataURL(file);}});$(document).on('click','#bb_btn_insert_img',function(e){e.preventDefault();$("#submit-error").html('');$.ajax({url:"/topic/insertImageBase64",type:"POST",dataType:'json',data:$('#forumFormImage').serialize(),cache:false,success:function(rs){if(rs.path!=undefined){$('#bb_lightbox_image').removeClass('pt-m-modal-mask');var t_area=$("#mobile-input");var path=rs.path;t_area.surroundSelectedText("[img]"+path+"[/img]","",true);t_area.focus();clearImageLightBox();return false;}
else{clearImageLightBox();$("#submit-error").html('เกิดข้อผิดพลาดระหว่างอัพโหลดรูป กรุณาลองใหม่อีกครั้งค่ะ<br/> และกรุณา Refresh หน้านี้ใหม่ค่ะ');return false;}}});});}
function defaultBoxText(){$('#pt-editor-switch').removeClass('active');$('#pt-upload-tool').removeClass('pt-m-editor__Inactive');$('#pt-upload-tool').addClass('pt-m-editor__Active');$('#pt-text-tool').removeClass('pt-m-editor__Active');$('#pt-text-tool').addClass('pt-m-editor__Inactive');}
function closeBoxPostText()
{$('#bb_lightbox_message').removeClass('pt-m-modal-mask');$("#mobileInsert").hide();$('body').removeClass('hide-scroll-modal');$("#mobile-input").val('');$('#pt_modal_menu_action').trigger('click');$("#bb_lightbox_pantip_toy").removeClass("pt-m-modal-mask");}
function clearImageLightBox()
{$('#bb_btn_insert_img').addClass('hidden-obj');$('#preview_photo').html('');$('#h_canvas_photo').val('');$('#photo_name').val('');$('#photo').val('');}
function commentReplyBoxPost(options)
{var txt_error='';var topic={topic_id:$('input[name=topic_id]').val(),topic_type:$('input[name=type]').val()};Object.assign(topic,options);$('body').removeClass('hide-scroll-modal');defaultBoxText();var ajax_send=false;if(ajax_send==false){ajax_send=true;$.ajax({url:"/topic/getUserPS",type:"POST",dataType:'json',data:topic,cache:false,success:function(rs){$('#list-share-icon').addClass('list-share__Inactive');$(".btn-scroll-top").hide();$('body').addClass('hide-scroll-modal');if(rs.error!=undefined){var option=null;txt_error=txtError(rs.error_type,option);if(rs.error_type!='logout'){$('.msg-bb_lightbox_message').html(txt_error);$('#bb_lightbox_message').addClass('pt-m-modal-mask');}
return false;}
else{if(rs.ps!=undefined){var txt_error_type='';var option=null;if(rs.ps.post==false){if($('[name=type]').val()==6){txt_error_type='typeTopic6';}else{txt_error_type='typeTopic';}}
else if(typeof rs.ps.post_over_limit!=='undefined'&&rs.ps.post_over_limit==true){txt_error_type='typeOverCommentLimit';option={text:rs.ps.limit};}else{var msg='';$('#expert_comment_m').prop("checked",false);$('.expert-account-mode').show();var cmdpost_reply=$('input[name=cmpost]').val();if(cmdpost_reply!=undefined&&(cmdpost_reply=='reply'||cmdpost_reply=='editreply')){$('.expert-account-mode').hide();}
if(rs!=undefined){commentnumber_edit='0';if(rs.inforeply!=undefined){reply=rs.inforeply;commentnumber_edit=reply['comment_no']+'-'+reply['reply_no'];if(reply['reply_id']!=undefined){msg=reply['raw_message'];$("#replynumber").html(commentnumber_edit);$("input[name=comment_no]").val(reply['comment_no']);$("input[name=rp_id]").val(reply['reply_id']);$("input[name=ref_comment]").val(commentnumber_edit);}}
if(rs.infocomment!=undefined&&rs.infocomment.raw_message!=undefined){msg=rs.infocomment.raw_message;if(rs.infocomment.expert!=undefined){if(rs.infocomment.expert===true){$('#expert_comment_m').prop("checked",true);}}}}
$("#mobile-input").val(msg);$("#mobileInsert").show();}
if(txt_error_type!=''){txt_error=txtError(txt_error_type,option);$('.msg-bb_lightbox_message').html(txt_error);$('#bb_lightbox_message').addClass('pt-m-modal-mask');return false;}}
if(rs.user_meta!=undefined&&rs.user_meta.expert!=undefined){comment_focus();}else{$('.expert-account-mode').remove();comment_focus();}}
ajax_send=false;$(".pt-dropdown-menu").removeClass("pt-block-surface--open");$("#pt_modal_menu_action").removeClass("pt-modal-mask");}});}}
$.comment.postFormComment=function()
{$(document).on('click','#button_postcomment',function(){var myFormData={};var cmpostData={};if($('input[name=comment_no]').val()==undefined){cmpostData=[{name:'cmpost',value:'comment'}]}
Object.assign(myFormData,cmpostData,[{name:'msg[time]',value:(new Date).getTime()}]);$.each(myFormData,function(index,myData){$('#mform_comment').append('<input type="hidden" name='+myData.name+' value='+myData.value+'>');});$('#mform_comment').submit();});$(document).on('click','#writeComment , .post-writecomment',function(){var mode='comment';var options={mode:mode};commentReplyBoxPost(options);$("#replynumber").html('');$("#commentnumber").html('');});}
$.reply.replyRemove=function()
{$(document).on('click','.close-comment-box',function(){$('.reply-form').html('');});}
$.reply.postComment=function()
{$(document).on('click','.reply-comment',function(){$("#mobile-input").val('');$("#replynumber").html('');$("#commentnumber").html('');var replyid=$(this).data('rppost');var commentno=$(this).data('cmno');var ref=$(this).data('ref');$("#replynumber").html(commentno);$("#commentnumber").html('<input type="hidden" name="comment_no" value="'+commentno+'"/>'
+'<input type="hidden" name="cmpost" value="reply"/>'
+'<input type="hidden" name="msg[ref_id]" value="'+replyid+'pantip3g"/>'
+'<input type="hidden" name="msg[ref_comment]" value="comment'+commentno+'"/>'
+'<input type="hidden" name="msg[ref]" value="'+ref+'"/>');var mode='reply';var options={mode:mode};commentReplyBoxPost(options);});}
function txtError(errNo,option)
{var txt_error='';if(errNo=='typeOtherPermission'){txt_error='<div class="comment-msg-errortxt">'
+'<ol class="readlist">'
+'บัญชีของคุณไม่สามารถใช้ฟังก์ชั่นนี้ได้'
+'</ol>'
+'<a class="focus02-txt" target="_blank" href="https://pantip.com/settings/profile">ยืนยันตัวตนที่นี่</a>'
+'</div>';}
else if(errNo=='typeTopic6'){txt_error='<div class="comment-msg-errortxt">'
+'<ol class="readlist">'
+'เฉพาะสมาชิกที่ยืนยันตัวตนด้วยบัตรประชาชน และเป็นสมาชิกไม่ต่ำกว่า 3 เดือนเท่านั้น ถึงจะตอบกระทู้ขายของได้'
+'</ol>'
+'</div>'}
else if(errNo=='typeTopic'){txt_error='<div class="comment-msg-errortxt">'
+'<ol class="readlist">'
+'สิทธิของสมาชิกคุณไม่สามารถตอบกระทู้ประเภทนี้ได้'
+'</ol>'
+'<a class="focus02-txt" target="_blank" href="https://pantip.com/settings/profile">ยืนยันตัวตนที่นี่</a>'
+'</div>';}
else if(errNo=='typeOverCommentLimit'){txt_error='<div class="comment-msg-errortxt">'
+'<ol class="readlist">'
+'คุณสามารถตอบกระทู้ได้ไม่เกินวันละ '+option['text']+' คอมเมนต์'
+'</ol>'
+'<a class="focus02-txt" target="_blank" href="https://pantip.com/settings/profile">ยืนยันตัวตนที่นี่</a>'
+'</div>';}
else if(errNo=='logout'){var redirect_url='?redirect='+encodeURIComponent(window.btoa(window.location.href));var urlLogin=$.comment.defaults.urlLogin;window.location=urlLogin+redirect_url;}
else if(errNo=='lost_data'){txt_error='<div class="comment-msg-errortxt">'
+'<ol class="readlist">'
+'เกิดข้อผิดพลาดขึ้น กรุณาลองใหม่อีกครั้ง'
+'</ol>'
+'</div>';}
else if(errNo=='confirm'){var text='ยืนยันค่ะ';if(option!==undefined){text=option['text'];$('#title_bb_lightbox_message').html(option['title']);}
txt_error='<div class="comment-msg-errortxt">'
+'<ol class="readlist">'
+text
+'</ol>'
+'</div>';}
return txt_error;}
$.comment.editPostComment=function()
{$(document).on('click','.edit-comment',function(){$("#mobile-input").val('');$("#replynumber").html('');$("#commentnumber").html('');var replyid=$(this).data('rppost');var commentno=$(this).data('cmno');var ref=$(this).data('ref');var mode='editcomment';var options={mode:mode,commentid:replyid};$("#replynumber").html(commentno);$("#commentnumber").html('<input type="hidden" name="comment_no" value="'+commentno+'"/>'
+'<input type="hidden" name="cmpost" value="'+mode+'"/>'
+'<input type="hidden" name="cid" value="'+replyid+'"/>'
+'<input type="hidden" name="msg[ref_id]" value="'+replyid+'pantip3g"/>'
+'<input type="hidden" name="msg[ref_comment]" value="comment'+commentno+'"/>'
+'<input type="hidden" name="msg[ref]" value="'+ref+'"/>');commentReplyBoxPost(options);});return false;}
$.comment.showDeleteCommentReply=function()
{$(document).on('click','.display-post-wrapper.with-top-border.section-comment.sub-comment',function(){$(this).hide();var class_selector='.'+$(this).attr('id');var count_selector=$(class_selector).length;$(class_selector).show();for(var i=0;i<count_selector;i++){var each_comment=$(class_selector).eq(i);var cp=each_comment.attr('id');if(cp!=undefined){var reply_more_sub_comment=each_comment.attr('id').replace('comment-','more-');$('#'+reply_more_sub_comment).show();}}});}
$.reply.editPostComment=function()
{$(document).on('click','.reply-edit-comment',function(){$("#mobile-input").val('');$("#replynumber").html('');$("#commentnumber").html('');var commentid=$(this).data('refcid');var replyno=$(this).data('rppost');var commentno=$(this).data('cmno');var mode='editreply';var options={mode:mode,commentid:commentid,reply_no:replyno};$("#replynumber").html(commentno);$("#commentnumber").html('<input type="hidden" name="comment_no" value=""/>'
+'<input type="hidden" name="cmpost" value="'+mode+'"/>'
+'<input type="hidden" name="cid" value="'+commentid+'"/>'
+'<input type="hidden" name="rp_no" value="'+replyno+'"/>'
+'<input type="hidden" name="rp_id" value=""/>'
+'<input type="hidden" name="ref_comment" value=""/>');commentReplyBoxPost(options);});}
$.comment.actionReportMessage=function()
{$(document).on('click','#pt_report_message_sent',function(){$('.report_email_note').html('').removeClass('note-error').addClass('invalid');$('.report_privacy_note').removeClass('note-error').addClass('invalid');$('.report_rule_note').html('').removeClass('note-error').addClass('invalid');var emailVal=$("input[name=report_email]").val();var report_type=parseInt($("input[name=report_type]:checked").val());var report_type_rule=parseInt($("input[name=report_type_rule]:checked").val());var checkVal=true;if(!$("input[name=chk_privacy_policy]").is(':checked')){$('.report_privacy_note').removeClass('invalid').addClass('note-error');checkVal=false;}
if(emailVal.length==0){$('.report_email_note').html('กรุณาระบุอีเมลของคุณ').removeClass('invalid').addClass('note-error');checkVal=false;}
else{if(!checkEmail(emailVal)){$('.report_email_note').html('กรุณากรอกอีเมลให้ถูกต้อง').removeClass('invalid').addClass('note-error');checkVal=false;}}
if(isNaN(report_type)||isNaN(report_type_rule)){$('.report_rule_note').html('กรุณาเลือกเหตุผลที่ต้องการแจ้งด้วยค่ะ').removeClass('invalid').addClass('note-error');checkVal=false;}
if(report_type_rule==4||report_type_rule==11){var other_detail='';$("input[name=other_detail]").val('');if(report_type_rule==4){var detail1=$.trim($("textarea[name=other_detail_1]").val());if(detail1.length==0){$('.report_rule_note').html('กรุณาระบุเหตุผลอื่นๆ ที่ต้องการแจ้งด้วยค่ะ').removeClass('invalid').addClass('note-error');checkVal=false;}
else{other_detail=$("textarea[name=other_detail_1]").val();$("input[name=other_detail]").val(other_detail);}}
if(report_type_rule==11){var detail2=$.trim($("textarea[name=other_detail_2]").val());if(detail2.length==0){$('.report_rule_note').html('กรุณาระบุเหตุผลอื่นๆ ที่ต้องการแจ้งด้วยค่ะ').removeClass('invalid').addClass('note-error');checkVal=false;}
else{other_detail=$("textarea[name=other_detail_2]").val();$("input[name=other_detail]").val(other_detail);}}}
if(checkVal===true){var data=$('#form_report_message').serializeArray().reduce(function(newData,item){if(item.name.substring(item.name.length-2)==='[]'){var key=item.name.substring(0,item.name.length);if(typeof(newData[key])==='undefined'){newData[key]=[];}
newData[key].push(item.value);}else{newData[item.name]=item.value;}
return newData;},{});var idtextpost=$(this).data('reportidtextpost');var result_data=set_data_for_action(idtextpost);var data_detail=result_data.data;Object.assign(data,data_detail);var ajax_send=false;var url_report='/feeling/reportPostMessage';if(ajax_send==false){ajax_send=true;$.ajax({url:url_report,type:"POST",dataType:'json',data:data,cache:false,success:function(rs){$('.data-msg-error').hide();$('.data-msg-success').hide();if(rs!=null&&rs.report_success=='TRUE'){$('.data-msg-success').show();}
else{$('.data-msg-error').show();}
$('.pt-report-message-menu').removeClass('pt-modal-mask');$('.pt-report-message-menu-message').addClass('pt-modal-mask');ajax_send=false;return false;}});return false;}}});$(document).on('click','input[name=report_type]',function(){$("input[name=report_type_rule]").prop("checked",false);$(".report_type_rule_other").hide();$("textarea[name=other_detail_1]").val('');$("textarea[name=other_detail_2]").val('');$("input[name=other_detail]").val('');});$(document).on('click','input[name=report_type_rule]',function(){var thisVal=parseInt($(this).val());$('.report_rule_note').html('').removeClass('note-error').addClass('invalid');if(thisVal>4&&thisVal<=11){$("input[name=report_type]").prop("checked",false);$("input[name=report_type][value=2]").prop("checked",true);$("textarea[name=other_detail_1]").val('');$("textarea[name=other_detail_2]").val('');$("input[name=other_detail]").val('');}
else{$("input[name=report_type]").prop("checked",false);$("input[name=report_type][value=1]").prop("checked",true);$("textarea[name=other_detail_1]").val('');$("textarea[name=other_detail_2]").val('');$("input[name=other_detail]").val('');}
if(thisVal==11||thisVal==4){$(".report_type_rule_other").hide();$("textarea[name=other_detail_1]").val('');$("textarea[name=other_detail_2]").val('');$("input[name=other_detail]").val('');$(".report_type_rule_"+thisVal).show();}});$(document).on('click','.report-message-post',function(){$('.report_email_note').html('').removeClass('note-error').addClass('invalid');$('.report_privacy_note').removeClass('note-error').addClass('invalid');$('.report_rule_note').html('').removeClass('note-error').addClass('invalid');$("#pt_report_message_sent").data('reportidtextpost',$(this).data('reportidtextpost'));$("#form_report_message")[0].reset();$('div.pt-dialog__content').first().animate({scrollTop:0},100);$(".pt-report-message-menu").addClass("pt-modal-mask");$(".pt-dropdown-menu").removeClass("pt-block-surface--open");$("#pt_modal_menu_action").removeClass("pt-modal-mask");$(".pt-report-message-menu-message").removeClass("pt-modal-mask");$(".report_type_rule_other").hide();$("textarea[name=other_detail_1]").val('');$("textarea[name=other_detail_2]").val('');$("input[name=other_detail]").val('');toCsElmStream($(this).data('reportidtextpost'),'inform');});$(document).on('click','.pt-report-message-clear , .pt-report-message-cancel',function(){$("#form_report_message")[0].reset();$(".pt-report-message-menu").removeClass("pt-modal-mask");$(".pt-report-message-menu-message").removeClass("pt-modal-mask");$("#pt_modal_menu_action").removeClass("pt-modal-mask");$('body').removeClass('hide-scroll-modal');});}
$.comment.actionVote=function()
{$(document).on('click','.pt-m-vote-button',function(){$("#pt_modal_menu_action").removeClass("pt-modal-mask");var idtextpost=$(this).data('idtextpost');var thisAction=$("div[data-idtextpost='"+idtextpost+"']");thisAction.addClass('action-button-vote');if(thisAction.hasClass('action-button-vote')){var result_data=set_data_for_action(idtextpost);var data=result_data.data;var type=result_data.type;var bb_lightbox_action_vote=$('#bb_lightbox_action_vote');if(type!=undefined||type==''){$.ajax({url:"/feeling/getVoteMember",type:"POST",dataType:'json',data:data,cache:false,success:function(rs){if(rs.status===true){clearInterval(x);thisAction.removeClass('not-vote');var eventVal='';var message=rs.vote.vote_message;if(rs.vote.vote_remain_time!=undefined){countDownTimerVote(rs.vote.vote_remain_time);message=rs.vote.vote_message+' คุณจะได้รับสิทธิ์เพิ่มในอีก <span id="pt_vote_remain_time"></span>';}
$('#bb_action_message').html(message);if(rs.vote.vote_active===true){eventVal='vote:add';if(!hasClass('color-votes')){thisAction.addClass('color-votes');}
if(!hasClass('not-vote')){thisAction.addClass('not-vote');}
bb_lightbox_action_vote.addClass('pt-toast--open');$("#pt_modal_menu_action").addClass("pt-modal-mask");}
else{thisAction.addClass('not-vote');eventVal='vote:del';}
if(rs.vote.vote_total==0){thisAction.removeClass('color-votes');if(!hasClass('not-vote')){thisAction.addClass('not-vote');}}
toCsElmStream(idtextpost,eventVal);thisAction.find(".pt-m-count-vote").html(rs.vote.vote_total);thisAction.removeClass('action-button-vote');return false;}
else{if(rs.error_type!=undefined){var option=null;txt_error=txtError(rs.error_type,option);if(rs.error_type!='logout'){$('.msg-bb_lightbox_message').html(txt_error);$('#bb_lightbox_message').addClass('pt-m-modal-mask');}
return false;}
else{$('#bb_action_message').html(rs.message);bb_lightbox_action_vote.addClass('pt-toast--open');$("#pt_modal_menu_action").addClass("pt-modal-mask");thisAction.removeClass('action-button-vote');return false;}}}});}}});$(document).on('click','.bb_btn_action_close',function(){$('#bb_lightbox_action_vote').removeClass('pt-toast--open');$("#pt_modal_menu_action").removeClass("pt-modal-mask");clearInterval(x);return false;});}
function comment_focus()
{setTimeout(function(){$('#mobile-input').focus();},500);}
function toCsElmStream(datapost,eventVal)
{$event=eventVal;var data=getDataCSDetailTopic(datapost);comment=data.comment;$topic_id=data.topic_id;ajax_process($event);}
function countDownTimerVote(countDownDateVote)
{var countDown=0;x=setInterval(function(){var now=new Date().getTime();var distance=now;var countDownDate=countDownDateVote-countDown;var minutesTime=(countDownDate/60);var secondsTime=(countDownDate%60);var minutes=Math.floor(minutesTime);var seconds=Math.floor(secondsTime);if(minutes<10){minutes='0'+minutes;}
if(seconds<10){seconds='0'+seconds;}
var timeVote=minutes+":"+seconds+" นาที";countDown++;$('#pt_vote_remain_time').html(timeVote);if(countDown==20||(seconds==0&&minutes==0)){distance=-1;}
if(distance<0){clearInterval(x);$('#pt_vote_remain_time').html("00:00 นาที");}},1000);}
$.comment.actionEmotion=function()
{$(document).on('click','.pt-m-reaction-button',function(){var this_active=$(this);var txt_error='';var topic={topic_id:$('input[name=topic_id]').val(),topic_type:$('input[name=type]').val()};var ajax_send=false;if(ajax_send==false){ajax_send=true;$.ajax({url:"/topic/getUserPS",type:"POST",dataType:'json',data:topic,cache:false,success:function(rs){if(rs.error!=undefined){var option=null;txt_error=txtError(rs.error_type,option);if(rs.error_type!='logout'){$('.msg-bb_lightbox_message').html(txt_error);$('#bb_lightbox_message').addClass('pt-m-modal-mask');}
return false;}
$('#pt_modal_menu_action').addClass('pt-modal-mask');this_active.next(".pt-m-reaction-list").addClass('active');ajax_send=false;return false;}});return false;}});$(document).on('click','.reaction_action',function(){var idtextpost=$(this).parent().parent('.pt-m-reaction-list').data('idtextpost');var emoji=$(this).data('reactionlistemo');var path_emoji_default='https://ptcdn.info/mobile/icon_post/emoji01.png';var path_emoji=path_emoji_default;if(emoji!=''){path_emoji='https://ptcdn.info/mobile/icon_post/'+emoji;}
$(this).parent().parent(".pt-m-reaction-list").removeClass('active');$('#pt_modal_menu_action').removeClass('pt-modal-mask');var emo_type=emotion_data_type(emoji);var result_data=set_data_for_action(idtextpost);var data=result_data.data;var type=result_data.type;Object.assign(data,{emo_type:emo_type});var eventVal='emo:'+emo_type;toCsElmStream(idtextpost,eventVal);var emo_type_img='emoji01.png';var myEmoArray={'emo_like':'emoji00.png','emo_laugh':'emoji01.png','emo_love':'emoji02.png','emo_impress':'emoji03.png','emo_scary':'emoji04.png','emo_surprised':'emoji05.png'};if(type!=undefined||type==''){$.ajax({url:"/feeling/saveEmotion",type:"POST",dataType:'json',data:data,cache:false,success:function(rs){if(rs.status==true){var emotion=rs.emotion;if(emotion!=undefined&&emotion.emo_active==false){path_emoji=path_emoji_default;}
if(emotion!=undefined&&emotion.emo_total=='0'){$('.pt-m-reaction-list-area[data-idtextpostemo="'+idtextpost+'"] > ul > li').remove();$('.pt-m-reaction-list-area[data-idtextpostemo="'+idtextpost+'"] > ul').html('<li><a href="javascript:void(0);"><img src="'+path_emoji+'"></a></li>');}
else{var path_url='https://ptcdn.info/mobile/icon_post/';var path_emoji_img=path_emoji_default;var li_emo_img='';$(emotion.emo_sort).each(function(index,name){if(emo_type_img!=''){emo_type_img=myEmoArray[name];path_emoji_img=path_url+emo_type_img;li_emo_img+='<li><a href="javascript:void(0);"><img src="'+path_emoji_img+'"></a></li>';}});$('.pt-m-reaction-list-area[data-idtextpostemo="'+idtextpost+'"] > ul').html(li_emo_img);}
$('.pt-m-reaction-button[data-idtextpostemo="'+idtextpost+'"] > a > img').attr('src',path_emoji);$('.pt-m-reaction-list-area[data-idtextpostemo="'+idtextpost+'"] > span').html(emotion.emo_total)}
else{if(rs.error_type!=undefined){var option=null;txt_error=txtError(rs.error_type,option);if(rs.error_type!='logout'){$('.msg-bb_lightbox_message').html(txt_error);$('#bb_lightbox_message').addClass('pt-m-modal-mask');}
return false;}}}});}
return false;});$(document).on('click','.pt-m-reaction-list-area',function(){var emotionsum=$(this).find('span.pt-m-list-count-reaction').html();if(emotionsum>0){var idtextpost=$(this).data('idtextpostemo');var result_data=set_data_for_action(idtextpost);get_emotion_data(result_data.data,result_data.type);$('#bb_lightbox_action_emotion').addClass('pt-block-surface--open');$('#pt_modal_menu_action').addClass('pt-modal-mask');$('body').addClass('hide-scroll-modal');}
return false;});$(document).on('click','.pt-emotion-view',function(){$('.pt-emotion-view').removeClass('tabs-active');$(this).addClass('tabs-active');$('.pt_list_members_emotype').hide();var emo_type=$(this).data('emotypegroup');if(emo_type=='all'){$('.pt_list_members_emotype').show();}
else{$('.pt_list_members_emotype[data-emotypegrouplist="'+emo_type+'"]').show();}
return false;});}
function emotion_data_type(name_emo)
{var emo_type='like';var myEmoArray={'emoji00.png':'like','emoji01.png':'laugh','emoji02.png':'love','emoji03.png':'impress','emoji04.png':'scary','emoji05.png':'surprised'};emo_type=myEmoArray[name_emo];return emo_type;}
function set_data_for_action(idtextpost)
{var arrType=idtextpost.split(':');var type=arrType[0];var arrTypePost=arrType[1].split('-');var topic_id=arrTypePost[0];var comment_id=0;var comment_no=0;var reply_no=0;var data={};var result_data={};if(type=='topic'){data={'topic_id':topic_id};}
if(type=='comment'||type=='reply'){comment_id=arrTypePost[1];comment_no=arrTypePost[2];data={'topic_id':topic_id,'comment_id':comment_id,'comment_no':comment_no};if(type=='reply'){reply_no=arrTypePost[3];reply_id=arrTypePost[4];data={'topic_id':topic_id,'comment_id':comment_id,'comment_no':comment_no,'reply_no':reply_no,'reply_id':reply_id};}}
result_data={data,type};return result_data;}
function get_emotion_data(data,type)
{$('#data_emotion_result').html('');if(type!=undefined||type==''){$.ajax({url:"/feeling/getEmotionList",type:"POST",dataType:'html',data:data,cache:false,success:function(dataHtml){$('#data_emotion_result').html(dataHtml);}});}
return true;}
function checkEmail(str_email)
{var filter=/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;if(!filter.test(str_email)){return false;}
else{return true;}}
$.pinIt={};$.pinIt.pinComment=function(){if($('.mypinit-datamark').val()!='false'){var delayInMilliseconds=3000;$('#comments-counts').addClass("load-pinit").delay(delayInMilliseconds).queue(function(){$(this).removeClass("load-pinit");markCommentPinItNext();});}}
$.pinIt.mark=function(){$(document).on('click','.pin-it, .comment-pinit',function(){var this_pinit=$(this);var comment_number=0;var ajax_send=false;var txt_error='';var topic={topic_id:$('input[name=topic_id]').val(),topic_type:$('input[name=type]').val()};if(ajax_send==false){ajax_send=true;$.ajax({url:"/topic/getUserPS",type:"POST",dataType:'json',data:topic,cache:false,success:function(rs){if(rs.error_type!=undefined){var option=null;txt_error=txtError(rs.error_type,option);if(rs.error_type!='logout'){$('.msg-bb_lightbox_message').html(txt_error);$('#bb_lightbox_message').addClass('pt-m-modal-mask');}
return false;}
else{var action_pin='';if(this_pinit.hasClass('pin-it')){comment_number=this_pinit.data('pinit');action_pin='';$('.mypinit-datamark').val('false');$('.pinit_comment'+this_pinit.data('pinit')).addClass('comment-unpin');$('.menu_pinit_comment'+this_pinit.data('pinit')).html('<span class="pt-lists-item__graphic material-icons">turned_in_not</span>'
+'<span class="pt-lists-item__text">อ่านถึงตรงนี้</span>');$('.pinit_comment'+this_pinit.data('pinitpost')).addClass('comment-unpin');}
else{if(this_pinit.data('pinitpost')!==undefined){action_pin='save';comment_number=this_pinit.data('pinitpost');$('.mypinit-datamark').val('comment'+comment_number);if($('.pinit_comment'+this_pinit.data('pinitpost')).hasClass('comment-unpin')){$(".display-post-pin.read-comment-pinit").addClass('comment-unpin');$('.read-pinit').html('<span class="pt-lists-item__graphic material-icons">turned_in_not</span>'
+'<span class="pt-lists-item__text">อ่านถึงตรงนี้</span>');$('.pinit_comment'+this_pinit.data('pinitpost')).removeClass('comment-unpin');this_pinit.addClass('read-pinit').html('<span class="pt-lists-item__graphic material-icons">turned_in</span>'
+'<span class="pt-lists-item__text">ยกเลิกอ่านถึงตรงนี้</span>');}
else{action_pin='';$('.mypinit-datamark').val('false');this_pinit.addClass('read-pinit').html('<span class="pt-lists-item__graphic material-icons">turned_in_not</span>'
+'<span class="pt-lists-item__text">อ่านถึงตรงนี้</span>');$('.pinit_comment'+this_pinit.data('pinitpost')).addClass('comment-unpin');}}
$('body').removeClass('hide-scroll-modal');$(".pt-dropdown-menu").removeClass("pt-block-surface--open");$("#pt_modal_menu_action").removeClass("pt-modal-mask");}
if(comment_number!=0){pinIt(comment_number,$('input[name=topic_id]').val(),action_pin);}}}});}});};function pinIt(comment_number,tid,action_pin)
{if(tid>0&&comment_number!=""){if(action_pin=='save'){$event='pinit';ajax_process($event);}
$.ajax({type:"POST",url:"/feeling/mpin_it",dataType:'json',data:{'topic_id':tid,'mark':comment_number,'action_pin':action_pin},success:function(rs){if(rs.success){return true;}
else{var option=null;txt_error=txtError(rs.error_type,option);return false;}}});}
return true;}})(jQuery);